angular.module("filtrstackr.services",[]);angular.module("filtrstackr.services").factory("Defaults",["Types",function(b){var a={gauss:{},clouds:{seed:parseInt(1E5*Math.random())},flat:{},noise:{},blur:{},undefined:{},example:{invert:!1,distortion:10,smoothness:1,scaling:100}};return{getDefaults:function(c){void 0!==c&&(_.each(c.type.parameters,function(b,e,d){c[b]=void 0===a[c.type.id]||void 0===a[c.type.id][b]?1:a[c.type.id][b]}),c.alpha=1,c.blendMode=b.getBlendModeById("normal"))}}}]);
angular.module("filtrstackr.services").factory("Filters",["Types",function(b){var a=0;return{list:[],add:function(b){b.id=a++;this.list.push(b)},remove:function(a){_.each(this.list,function(b,e,d){b.id===a.id&&d.splice(e,1)})},setNewType:function(a){}}}]);
angular.module("filtrstackr.services").factory("FilterItemVisibility",["Filters",function(b){return[]}]).factory("Renderer",["Types",function(b){var a,c,f={},e=function(a){var d={},e=new XMLHttpRequest;e.onload=function(b){if(200===this.status){b=a.createShader(a.VERTEX_SHADER);a.shaderSource(b,this.responseText);a.compileShader(b);if(!a.getShaderParameter(b,a.COMPILE_STATUS))return console.group(elm.id),console.log(a.getShaderInfoLog(b)),console.groupEnd(elm.id),null;d.VertexShader=b}};e.open("GET",
"shaders/VertexShader.glsl",!1);e.setRequestHeader("Accept","text/plain");e.send(null);_.each(b.list,function(b,c,e){c=new XMLHttpRequest;c.onload=function(c){if(200===this.status){c=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(c,this.responseText);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))return console.group(b.id),console.log(a.getShaderInfoLog(c)),console.groupEnd(b.id),null;d[b.id]=c}};c.open("GET","shaders/"+b.id+".glsl",!1);c.setRequestHeader("Accept","text/plain");
c.send(null)});_.each(b.list,function(b,e,g){e=d[b.id];var h=d.VertexShader;if(void 0!==e&&void 0!==h){g=a.createProgram();a.attachShader(g,h);a.attachShader(g,e);a.linkProgram(g);a.getProgramParameter(g,a.LINK_STATUS)||alert("Could not initialise shaders");a.useProgram(g);g.vertexPositionAttribute=a.getAttribLocation(g,"aVertexPosition");a.enableVertexAttribArray(g.vertexPositionAttribute);g.uniforms={};for(e=0;e<b.parameters.length;e++)g.uniforms[b.parameters[e]]=a.getUniformLocation(g,b.parameters[e]);
g.uniforms.tSampler=a.getUniformLocation(g,"tSampler");g.uniforms.res=a.getUniformLocation(g,"res");a.bindBuffer(a.ARRAY_BUFFER,c);a.vertexAttribPointer(g.vertexPositionAttribute,c.itemSize,a.FLOAT,!1,0,0);f[b.id]=g}})},d,h,k=!1;return{init:function(){var b=document.getElementById("glCanvas");try{a=b.getContext("experimental-webgl"),a.viewportWidth=b.width,a.viewportHeight=b.height}catch(f){}a||alert("Could not initialise WebGL, sorry :-(");c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);a.bufferData(a.ARRAY_BUFFER,
new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),a.STATIC_DRAW);c.itemSize=3;c.numItems=4;d=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,d);d.width=512;d.height=512;h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,d.width,d.height,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.generateMipmap(a.TEXTURE_2D);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,
a.TEXTURE_2D,h,0);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);e(a);a.clearColor(0,0,0,1);a.disable(a.DEPTH_TEST);k=!0},drawScene:function(b){k&&(console.log("Drawing scene!"),a.viewport(0,0,a.viewportWidth,a.viewportHeight),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),a.disable(a.BLEND),_.each(b,function(b,e,d){e=f[b.type.id];if(null!=e){a.useProgram(e);a.uniform2fv(e.uniforms.res,[a.viewportWidth,a.viewportHeight]);
for(d=0;d<b.type.parameters.length;d++){var h=b.type.parameters[d],g=b[h];void 0!==h&&void 0!==g&&a.uniform1f(e.uniforms[h],g)}void 0!==b.blendMode&&(a.blendFunc(a[b.blendMode.srcFactor],a[b.blendMode.dstFactor]),a.drawArrays(a.TRIANGLE_STRIP,0,c.numItems),a.enable(a.BLEND))}}))}}}]);
angular.module("filtrstackr.services").factory("Types",function(){return{list:[{name:"Clouds",id:"clouds",parameters:"alpha blendMode seed size depth nabla r g b".split(" ")},{name:"Flat color",id:"flat",parameters:["alpha","blendMode","r","g","b"]},{name:"Noise",id:"noise",parameters:["alpha","blendMode","amount"]},{name:"Plaid",id:"lines",parameters:"alpha blendMode scale r g b x y".split(" ")},{name:"Undefined filter",id:"undefined",parameters:[]},{name:"Example",id:"example",parameters:"alpha blendMode distortion smoothness scaling invert".split(" ")}],
blendModes:[{name:"Normal",id:"normal",srcFactor:"SRC_ALPHA",dstFactor:"ONE_MINUS_SRC_ALPHA"},{name:"Multiply",id:"multiply",srcFactor:"DST_COLOR",dstFactor:"ONE_MINUS_SRC_ALPHA"},{name:"Screen",id:"screen",srcFactor:"SRC_ALPHA",dstFactor:"ONE_MINUS_SRC_COLOR"}],getTypeById:function(b){for(var a=0;a<this.list.length;a++)if(this.list[a].id===b)return this.list[a];return null},getBlendModeById:function(b){for(var a=0;a<this.blendModes.length;a++)if(this.blendModes[a].id===b)return this.blendModes[a];
return null},setDefaults:function(b){},getDefaults:function(b){}}});angular.module("filtrstackr.directives",[]);angular.module("filtrstackr.directives").directive("scene",["Renderer",function(b){return{restrict:"EA",replace:!0,transclude:!1,template:"<canvas id='glCanvas' width='800px' height='800px'></canvas>",compile:function(a,c,f){return{pre:function(a,b,c,f){},post:function(a,c,f,k){b.init()}}}}}]);
angular.module("filtrstackr.directives").directive("input",["Types",function(b){return{restrict:"E",replace:!1,transclude:!1,require:"ngModel",link:function(a,b,f,e){"range"===f.type&&e.$parsers.push(function(a){return parseFloat(a)})}}}]).directive("seed",[function(){return{restrict:"E",replace:!0,transclude:!1,require:"ngModel",template:'<fieldset class="seed"><button class="seed-prev">&lt;</button><input type="text" ng-model="ngModel"></input><button class="seed-next">&gt;</button></fieldset>',
scope:{ngModel:"="},link:function(b,a,c,f){var e=[],d=0;a.find(".seed-prev").click(function(a){d--;void 0===e[d]&&(e[d]=parseInt(1E5*Math.random()));b.$apply(function(){b.ngModel=e[d]})});a.find(".seed-next").click(function(a){d++;void 0===e[d]&&(e[d]=parseInt(1E5*Math.random()));b.$apply(function(){b.ngModel=e[d]})});b.$watch("ngModel",function(){e[d]=b.ngModel})}}}]).directive("toRgb",[function(){return{restrict:"A",replace:!1,transclude:!1,scope:{toRgb:"=",ngModel:"="},link:function(b,a,c,f){b.$watch("ngModel",
function(){if(void 0!==b.ngModel){var c=b.ngModel.substring(1);b.toRgb.r=parseInt(c.substr(0,2),16)/255;b.toRgb.g=parseInt(c.substr(2,2),16)/255;b.toRgb.b=parseInt(c.substr(4,2),16)/255;window.test=a}})}}}]);angular.module("filtrstackr.filterlist",[]);
angular.module("filtrstackr.filterlist.directives",[]).directive("fsFilterControl",["Types",function(b){return{restrict:"A",replace:!1,transclude:!1,scope:{fsFilterControl:"="},link:function(a,c,f,e){a.url="partials/"+a.fsFilterControl.type.id+".html";a.types=b.list;a.blendModes=b.blendModes},templateUrl:"partials/filterControl.html"}}]).directive("sortable",["Filters",function(b){return{restrict:"EA",transclude:!1,replace:!0,scope:{fsModel:"="},compile:function(a,c,f){return{pre:function(a,c,f,k){c=
c.find("ul.orderlist").sortable({axis:"y",handle:"header"});c.on("sortdeactivate",function(){for(var c=_.map(this.children,function(a){return Number(a.getAttribute("fs-id"))}),d=[],f=0;f<c.length;f++)d[f]=b.list[c[f]];a.$apply(function(){angular.copy(d,b.list)})});c=a[f.fsModel]},post:function(a,b,c,f){}}},templateUrl:"partials/filterlist.html"}}]).directive("filteritem",["FilterItemVisibility",function(b){return{restrict:"EA",replace:!1,transclude:!1,scope:{fsItem:"=",fsIndex:"="},templateUrl:"partials/filteritem.html"}}]).directive("fsSelect",
["Types","Defaults",function(b,a){return{restrict:"EA",replace:!1,transclude:!1,scope:{fsSelect:"=",fsSelType:"="},link:function(c,f,e,d){f.change(function(){c.$apply(function(){var d=e.fsSelType;"type"===d?(d=b.getTypeById(f.val()),d.id!=c.fsSelect.id&&(c.fsSelect.type=d,a.getDefaults(c.fsSelect))):"blend"===d&&(c.fsSelect=b.getBlendModeById(f.val()))})})}}}]);
angular.module("filtrstackr.filterlist.controllers",[]).controller("filterItem",["$scope","FilterItemVisibility","Filters",function(b,a,c){b.visibility=a;b.getVis=function(b){return a[b.id]};b.toggle=function(b){a[b.id]=!a[b.id]};b.removeFilter=function(a){console.log("tjo");c.remove(a)}}]);
angular.module("filtrstackr","ngRoute filtrstackr.filters filtrstackr.services filtrstackr.directives filtrstackr.filterlist filtrstackr.filterlist.directives filtrstackr.filterlist.controllers colorpicker.module filtrstackr.controllers".split(" ")).config(["$routeProvider",function(b){b.when("/",{controller:"main"});b.otherwise({redirectTo:"/view1"})}]);
angular.module("filtrstackr.controllers",[]).controller("main",["$scope","Types","Filters","FilterItemVisibility","Renderer",function(b,a,c,f,e){var d=window.location.search.split("[?&]").slice(0);b.isDebug="debug=1"===d[0];b.filters=c.list;b.types=a.list;b.newFilter=function(){console.log("addfilter");var b={};b.type=a.getTypeById("undefined");c.add(b);_.each(f,function(a,b,c){f[b]=!1});f[b.id]=!0};b.$watch("filters",function(){e.drawScene(c.list)},!0)}]);
angular.module("filtrstackr.filters",[]).filter("interpolate",["version",function(b){return function(a){return String(a).replace(/\%VERSION\%/mg,b)}}]);
